# Path to your bulk.json file
$bulkFilePath = "C:\path\to\bulk.json"

# Cloudflare info (all REAL values, no angle brackets)
$accountId   = "YOUR_REAL_ACCOUNT_ID"         # looks like a UUID
$namespaceId = "YOUR_REAL_NAMESPACE_ID"       # the KV namespace ID, NOT the name
$apiToken    = "YOUR_REAL_API_TOKEN"

# Read JSON body
$body = Get-Content -Raw -Path $bulkFilePath

# API endpoint for KV bulk put
$uri = "https://api.cloudflare.com/client/v4/accounts/$accountId/storage/kv/namespaces/$namespaceId/bulk"

# Headers
$headers = @{
    "Authorization" = "Bearer $apiToken"
    "Content-Type"  = "application/json"
}

Write-Host "Uploading bulk KV data to namespace $namespaceId ..." -ForegroundColor Cyan

try {
    $response = Invoke-RestMethod -Method Put -Uri $uri -Headers $headers -Body $body
    Write-Host "Success:" $response.success
    Write-Host "Errors:"  ($response.errors   | ConvertTo-Json -Depth 5)
    Write-Host "Messages:" ($response.messages | ConvertTo-Json -Depth 5)
}
catch {
    Write-Host "Request failed with status code:" $_.Exception.Response.StatusCode.value__ -ForegroundColor Red
    $errorBody = New-Object System.IO.StreamReader($_.Exception.Response.GetResponseStream())
    $errorText = $errorBody.ReadToEnd()
    Write-Host "Response body from Cloudflare:" -ForegroundColor Yellow
    Write-Host $errorText
}
